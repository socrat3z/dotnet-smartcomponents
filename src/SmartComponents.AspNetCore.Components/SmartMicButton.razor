@namespace SmartComponents
@using Microsoft.AspNetCore.Components.Forms
@inject IServiceProvider Services

<button type="button"
        title="Use voice input to fill out the form"
        class="smart-mic-button"
        @attributes="AdditionalAttributes"
        data-url="_smartcomponents/smartpaste"
        data-smart-mic-trigger="true"
        data-antiforgery-name="@antiforgeryToken?.FormFieldName"
        data-antiforgery-value="@antiforgeryToken?.Value">
    @if (DefaultIcon)
    {
        <text><svg class="smart-mic-icon smart-mic-icon-normal" fill="currentColor" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
            <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"/>
            <path d="M10 8a2 2 0 1 1-4 0V3a2 2 0 1 1 4 0v5zM8 0a3 3 0 0 0-3 3v5a3 3 0 0 0 6 0V3a3 3 0 0 0-3-3z"/>
        </svg></text>
        <text><svg class="smart-mic-icon smart-mic-icon-running" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g stroke="currentColor"><circle cx="12" cy="12" r="9.5" fill="none" stroke-width="3" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" calcMode="spline" values="0 150;42 150;42 150;42 150" keyTimes="0;0.475;0.95;1" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" repeatCount="indefinite" /><animate attributeName="stroke-dashoffset" dur="1.5s" calcMode="spline" values="0;-16;-59;-59" keyTimes="0;0.475;0.95;1" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" repeatCount="indefinite" /></circle><animateTransform attributeName="transform" type="rotate" dur="2s" values="0 12 12;360 12 12" repeatCount="indefinite" /></g></svg></text>
    }
    @ChildContent
</button>

@code {
    ConditionalAntiforgery antiforgeryToken = default!;

    [Parameter]
    public bool DefaultIcon { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public IReadOnlyDictionary<string, object>? AdditionalAttributes { get; set; }

    // As with the "title" attribute, we expect this to be overridden in most realistic use cases.
    // For example, most apps will need to localize this.
    [Parameter]
    public RenderFragment ChildContent { get; set; } = @<text>Voice Input</text>;

    protected override void OnInitialized()
    {
        antiforgeryToken = new ConditionalAntiforgery(Services);
    }
}
