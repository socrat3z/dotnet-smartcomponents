@namespace SmartComponents
@using Microsoft.AspNetCore.Components.Forms
@inject IServiceProvider Services

<button type="button"
        title="Use voice input to fill out the form"
        class="smart-mic-button"
        @attributes="AdditionalAttributes"
        data-url="_smartcomponents/smartpaste"
        data-smart-mic-trigger="true"
        data-antiforgery-name="@antiforgeryToken?.FormFieldName"
        data-antiforgery-value="@antiforgeryToken?.Value">
    @if (DefaultIcon)
    {
        @* 
            Microphone icon SVG - inherits text color
        *@
        <text><svg class="smart-mic-icon" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
        </svg></text>
    }
    @ChildContent
</button>

@code {
    ConditionalAntiforgery antiforgeryToken = default!;

    [Parameter]
    public bool DefaultIcon { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public IReadOnlyDictionary<string, object>? AdditionalAttributes { get; set; }

    // As with the "title" attribute, we expect this to be overridden in most realistic use cases.
    // For example, most apps will need to localize this.
    [Parameter]
    public RenderFragment ChildContent { get; set; } = @<text>Voice Input</text>;

    protected override void OnInitialized()
    {
        antiforgeryToken = new ConditionalAntiforgery(Services);
    }
}
